<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<title>WANGR10 å®Œæ•´åŒæ­¥ç‰ˆ</title>
<style>
body{background:#111;color:#fff;font-family:Microsoft JhengHei;padding:20px;font-size:20px;}
.card{background:#222;padding:15px;border-radius:10px;margin:10px 0;border:1px solid #333;}
button{font-size:18px;padding:6px 12px;margin-left:5px;}
</style>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>

<script>
// firebaseConfig
const firebaseConfig = {
  apiKey: "AIzaSyDs9i1UKuvUohyE2dYQYk6nSBXHrvTvzEM",
  authDomain: "wangr-sync2.firebaseapp.com",
  projectId: "wangr-sync2",
  storageBucket: "wangr-sync2.firebasestorage.app",
  messagingSenderId: "1010873667172",
  appId: "1:1010873667172:web:ba68012141814fed241971"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

function fmt(t){
  const h = String(Math.floor(t/60)).padStart(2,"0");
  const m = String(t%60).padStart(2,"0");
  return `${h}:${m}`;
}

async function updateKill(name, killtime){
  const nowMin = Math.floor(Date.now()/60000);
  await db.collection("bosses").doc(name).update({
    lastkill: nowMin
  });
  alert(name+" å·²æ“Šæ®ºä¸¦åŒæ­¥ï¼");
}

window.onload = () =>{
  const container = document.getElementById("bossList");

  db.collection("bosses").onSnapshot(snap=>{
    container.innerHTML = "";
    snap.forEach(doc=>{
      const b = doc.data();
      const id = doc.id;

      const last = b.lastkill===0 ? "å°šæœªæ“Šæ®º" : fmt(b.lastkill);

      let div=document.createElement("div");
      div.className="card";
      div.innerHTML = `
        <div><b>${b.name}</b></div>
        <div>é‡ç”Ÿï¼š${b.respawn} åˆ†</div>
        <div>æ“Šæ®ºè€—æ™‚ï¼š${b.killtime} åˆ†</div>
        <div>ä¸Šæ¬¡æ“Šæ®ºï¼š${last}</div>
        <button onclick="updateKill('${id}',${b.killtime})">å·²æ“Šæ®º</button>
      `;

      container.appendChild(div);
    });
  });
};
</script>
</head>

<body>
<h1>ğŸ”¥ WANGR10 â€” å®Œæ•´åŒæ­¥åŸºç¤ç‰ˆ</h1>
<p>ï¼ˆæ“Šæ®ºã€æ™‚é–“è‡ªå‹•åŒæ­¥ï¼Œå¯æ“´å……å€’æ•¸/æé†’/å¾ªç’°ï¼‰</p>
<div id="bossList">è®€å–ä¸­â€¦</div>

</body>
</html>
